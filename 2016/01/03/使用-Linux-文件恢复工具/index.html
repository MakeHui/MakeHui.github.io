<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">



<title>
  
    使用 Linux 文件恢复工具
  
</title>

<meta name="description" content="本来从未想过要查找linux数据恢复相关的文章资料, 怎料自己手贱把自己的Blog给rm -rf了呢? 简直神作了, 虽然并没有把数据恢复回来, 但是经过测试下面的方法是可行的, 就顺手给记录下来, 用于惊醒自己这天所犯下的sb事.">
<meta property="og:type" content="article">
<meta property="og:title" content="使用 Linux 文件恢复工具">
<meta property="og:url" content="http://huyaohui.com/2016/01/03/使用-Linux-文件恢复工具/index.html">
<meta property="og:site_name" content="MakeHui's 超平和バスターズはずっとなかよし">
<meta property="og:description" content="本来从未想过要查找linux数据恢复相关的文章资料, 怎料自己手贱把自己的Blog给rm -rf了呢? 简直神作了, 虽然并没有把数据恢复回来, 但是经过测试下面的方法是可行的, 就顺手给记录下来, 用于惊醒自己这天所犯下的sb事.">
<meta property="og:image" content="https://img.alicdn.com/imgextra/i4/1134915854/TB21c9JjXXXXXbnXpXXXXXXXXXX_!!1134915854.jpg">
<meta property="og:image" content="https://img.alicdn.com/imgextra/i1/1134915854/TB2VSe0jXXXXXctXXXXXXXXXXXX_!!1134915854.jpg">
<meta property="og:image" content="https://img.alicdn.com/imgextra/i4/1134915854/TB2T4KLjXXXXXaLXpXXXXXXXXXX_!!1134915854.jpg">
<meta property="og:image" content="https://img.alicdn.com/imgextra/i1/1134915854/TB26LSGjXXXXXb2XpXXXXXXXXXX_!!1134915854.jpg">
<meta property="og:image" content="https://img.alicdn.com/imgextra/i1/1134915854/TB2X4SNjXXXXXaAXpXXXXXXXXXX_!!1134915854.jpg">
<meta property="og:image" content="https://img.alicdn.com/imgextra/i3/1134915854/TB29fmQjXXXXXXRXpXXXXXXXXXX_!!1134915854.jpg">
<meta property="og:image" content="https://img.alicdn.com/imgextra/i4/1134915854/TB2XWLXjXXXXXavXXXXXXXXXXXX_!!1134915854.jpg">
<meta property="og:image" content="https://img.alicdn.com/imgextra/i2/1134915854/TB27kaQjXXXXXabXpXXXXXXXXXX_!!1134915854.jpg">
<meta property="og:image" content="https://img.alicdn.com/imgextra/i4/1134915854/TB2vva.jXXXXXaSXXXXXXXXXXXX_!!1134915854.jpg">
<meta property="og:image" content="https://img.alicdn.com/imgextra/i1/1134915854/TB2wUiIjXXXXXbrXpXXXXXXXXXX_!!1134915854.jpg">
<meta property="og:image" content="https://img.alicdn.com/imgextra/i1/1134915854/TB20R2cjXXXXXXBXXXXXXXXXXXX_!!1134915854.jpg">
<meta property="og:image" content="https://img.alicdn.com/imgextra/i2/1134915854/TB2bb18jXXXXXbiXXXXXXXXXXXX_!!1134915854.jpg">
<meta property="og:updated_time" content="2016-04-03T17:50:39.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="使用 Linux 文件恢复工具">
<meta name="twitter:description" content="本来从未想过要查找linux数据恢复相关的文章资料, 怎料自己手贱把自己的Blog给rm -rf了呢? 简直神作了, 虽然并没有把数据恢复回来, 但是经过测试下面的方法是可行的, 就顺手给记录下来, 用于惊醒自己这天所犯下的sb事.">
<meta name="twitter:creator" content="@Make_hui">
<link rel="publisher" href="https://plus.google.com/u/0/104498839687178541049/posts">


  <link rel="alternative" href="/atom.xml" title="MakeHui&#39;s 超平和バスターズはずっとなかよし" type="application/atom+xml">



  <link rel="icon" href="/images/info/favicon.ico">


<link rel="stylesheet" href="/perfect-scrollbar/css/perfect-scrollbar.min.css" type="text/css">
<link rel="stylesheet" href="/styles/main.css" type="text/css">






</head>
<body
  
    class="monochrome"
  
  >
  <div class="mobile-header">
  <button class="sidebar-toggle" type="button">
    <span class="icon-bar"></span>
    <span class="icon-bar"></span>
    <span class="icon-bar"></span>
  </button>
  <a class="title" href="/">MakeHui&#39;s 超平和バスターズはずっとなかよし</a>
</div>

  <div class="main-container">
    <div class="sidebar">
  <div class="header">
    <h1 class="title"><a href="/">MakeHui&#39;s 超平和バスターズはずっとなかよし</a></h1>
    
      <p class="subtitle">
        あの日見た花の名前を僕達はまだ知らない。
      </p>
    
    <div class="info">
      <div class="content">
        
          <div class="description">超平和バスターズはずっとなかよし</div>
        
        
          <div class="author">MakeHui</div>
        
      </div>
      
        <div class="avatar">
          
            <a href="/about"><img src="/images/info/author.jpg"></a>
          
        </div>
      
    </div>
  </div>
  <div class="body">
    
      
        <ul class="nav">
          
            
              <li>
                <a href="/" title="Home">Home</a>
              </li>
            
          
        </ul>
      
        <ul class="nav">
          
            
              <li class="category-list-container">
                <a href="javascript:;">Category</a>
                <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Brew/">Brew</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/CentOS/">CentOS</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/CocosCreator/">CocosCreator</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Git/">Git</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/GitNoteR/">GitNoteR</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Google/">Google</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/HTML5/">HTML5</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Hexo/">Hexo</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Nginx/">Nginx</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Qt/">Qt</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/SSH/">SSH</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Software/">Software</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/TextEditor/">TextEditor</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Think/">Think</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Windows/">Windows</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Xcode/">Xcode</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/iOS/">iOS</a><span class="category-list-count">19</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/iTerm/">iTerm</a><span class="category-list-count">1</span></li></ul>
              </li>
            
          
            
              <li class="tag-list-container">
                <a href="javascript:;">Tag</a>
                <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Apache/">Apache</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Branckets/">Branckets</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Brew/">Brew</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Build/">Build</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/C-CPP/">C/CPP</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CLI/">CLI</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CMake/">CMake</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CentOS/">CentOS</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CocoaPods/">CocoaPods</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Cocos2d-x/">Cocos2d-x</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Cocos2dx/">Cocos2dx</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CocosCreator/">CocosCreator</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Config/">Config</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Cordova/">Cordova</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DNS/">DNS</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/FileDBR/">FileDBR</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Game/">Game</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Git/">Git</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GitHub/">GitHub</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GitHub-page/">GitHub page</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GitLab/">GitLab</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Google/">Google</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTML5/">HTML5</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hello-World/">Hello World</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hexo/">Hexo</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HybridApp/">HybridApp</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JMeter/">JMeter</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LNMP/">LNMP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Library/">Library</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/">Linux</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mac-OSX/">Mac OSX</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MySQL/">MySQL</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Nginx/">Nginx</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Note/">Note</a><span class="tag-list-count">17</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PHP/">PHP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Plugin/">Plugin</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Qt/">Qt</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SSH/">SSH</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ShareSDK/">ShareSDK</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Software/">Software</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Storyboard/">Storyboard</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Swift/">Swift</a><span class="tag-list-count">15</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TextEditor/">TextEditor</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Think/">Think</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Thunder/">Thunder</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Unity/">Unity</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Web/">Web</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WebApp/">WebApp</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Windows/">Windows</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Xcode/">Xcode</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/iOS/">iOS</a><span class="tag-list-count">20</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/iTerm/">iTerm</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/libgit2/">libgit2</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/libqgit2/">libqgit2</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sshpass/">sshpass</a><span class="tag-list-count">1</span></li></ul>
              </li>
            
          
            
              <li class="archive-list-container">
                <a href="javascript:;">Archive</a>
                <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/">2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/">2016</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/">2015</a><span class="archive-list-count">38</span></li></ul>
              </li>
            
          
        </ul>
      
        <ul class="nav">
          
            
              <li>
                <a href="/archives" title="By Year">By Year</a>
              </li>
            
          
        </ul>
      
        <ul class="nav">
          
            
              <li>
                <a href="/categories/iOS" title="iOS">iOS</a>
              </li>
            
          
            
              <li>
                <a href="/Niconiconi" title="Niconiconi">Niconiconi</a>
              </li>
            
          
        </ul>
      
        <ul class="nav">
          
            
              <li>
                <a href="https://github.com/MakeHui" title="Github" target="_blank" rel="external">Github</a>
              </li>
            
          
            
              <li>
                <a href="/atom.xml" title="RSS">RSS</a>
              </li>
            
          
        </ul>
      
    
  </div>
</div>

    <div class="main-content">
      
        <div style="max-width: 1000px">
      
          <article id="post-使用-Linux-文件恢复工具" class="article article-type-post">
  
    <h1 class="article-header">
      使用 Linux 文件恢复工具
    </h1>
  
  

  <div class="article-info">
    <span class="article-date">
  Write: 2016-01-03 Update: 2016-04-04
</span>

    
	<span class="article-category tagcloud">
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Linux/">Linux</a></li></ul>
	</span>


    
	<span class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux/">Linux</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Software/">Software</a></li></ul>
	</span>


  </div>
  <div class="article-entry">
    <p>本来从未想过要查找linux数据恢复相关的文章资料, 怎料自己手贱把自己的Blog给<code>rm -rf</code>了呢? 简直神作了, 虽然并没有把数据恢复回来, 但是经过测试下面的方法是可行的, 就顺手给记录下来, 用于惊醒自己这天所犯下的sb事. </p>
<a id="more"></a>
<h1 id="事件重现">事件重现</h1><p>起因: 本来想备份一下Blog的源代码</p>
<p>步骤: </p>
<ol>
<li><p>执行命令行执行压缩命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zip MakeHui.github.io.zip MakeHui.github.io</span><br></pre></td></tr></table></figure>
</li>
<li><p>少输入了<code>-r</code>, 只备份了个文件夹 o(╯□╰)o</p>
</li>
<li><p>于是删除压缩包. (想必大家都知道发生什么事了 %&gt;_&lt;%)</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm -rf Make[tab]    # &#25105;&#36825;&#37324;&#30452;&#25509;&#25353;tab&#34917;&#20840;&#30340;, &#28982;&#21518;&#24456;&#33258;&#28982;&#30340;&#23601;&#25353;&#20102;enter&#20581;, &#32467;&#26524;...</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>引以为戒, 引以为戒啊…</p>
<h1 id="下面转载文章">下面转载文章</h1><h2 id="使用_Linux_文件恢复工具">使用 Linux 文件恢复工具</h2><p>Linux 系统管理员守则中有这么一条：“慎用 rm -rf 命令，除非你知道此命令所带来的后果“，不过 Linux 下删除文件并不是真实的删除磁盘分区中的文件，而是将文件的 inode 节点中的扇区指针清除，同时释放这些数据对应的数据块，当释放的数据块被系统重新分配时，那些被删除的数据就会被覆盖，所以误删除数据后，应马上卸载文件所在的分区。然后使用相关工具进行恢复。本文以 Ubuntu 12.04 平台为例介介绍四个（foremost、extundelete、testdisk 和 phtorec）常用的 Linux 删除文件恢复工具的使用方法。</p>
<h2 id="Linux_文件恢复的原理">Linux 文件恢复的原理</h2><h3 id="inode_和_block">inode 和 block</h3><p>首先简单介绍一下 Linux 文件系统的最基本单元：inode。inode 译成中文就是索引节点，每个存储设备（例如硬盘）或存储设备的分区被格式化为文件系统后，应该有两部份，一部份是 inode，另一部份是 block，block 是用来存储数据用的。而 inode 呢，就是用来存储这些数据的信息，这些信息包括文件大小、属主、归属的用户组、读写权限等。inode 为每个文件进行信息索引，所以就有了 inode 的数值。linux 操作系统下可以使用 ls –id 命令来查看文件或者目录的 inode 值，一般”root”目录的 inode 值为 2,一个分区挂载到一个目录下时，这个”root”目录的 inode 值为 2<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mount /dev/sdb2 /tmp</span><br><span class="line">ls -id /tmp</span><br><span class="line"><span class="number">2</span> /tmp</span><br></pre></td></tr></table></figure></p>
<h3 id="文件恢复的原理">文件恢复的原理</h3><p>本文要介绍的命令是通过文件系统的 inode 值（一般是 2 ）来获取文件系统信息。在 ext3 和 ext4 文件系统中，每个文件都是通过 inode 来描述其数据存放的具体位置，当文件被删除以后，inode 的数据指针部分被清零，文件目录区没有太多变化。文件的读写都是通过 inode 来实现，当 inode 数据指针被清零以后，即便文件内容还在，也没有办法把文件内容组合出来。当 ext3 和 ext4 文件系统中的元数据 metadata 发生变化时，相应的元数据 metadata 在日志文件会有一份拷贝。比如一个文件被删除了，它的 inode 信息会在日志文件中先保存一份，然后把要删除文件 inode 相关信息清零。这个日志文件是循环使用的，当操作过多时，删除的文件的 inode 日志记录会被新的数据替换，这就彻底丧失了根据 inode 找回数据的机会了。如果是大量文件的删除，这个日志文件会被反复循环利用多次，只留给最后删除的那些文件的恢复机会。</p>
<h2 id="使用命令行工具恢复文件">使用命令行工具恢复文件</h2><h3 id="foremost_和_extundelete_简介">foremost 和 extundelete 简介</h3><p>formost 是一个基于文件头和尾部信息以及文件的内建数据结构恢复文件的命令行工具。这个过程通常叫做数据挖掘（data carvubg）。formost 可以分析由 dd、Safeback、Encase 等生成的镜像文件，也可以直接分析驱动器。文件头和尾可以通过配置文件设置，也可以通过命令行开关使用 formost 内建的文件类型。formost 最初是由美国空军特别调查室（Air Force Office of Special Investigations）和信息系统安全研究中心（The Center for Information Systems Security Studies and Research）开发的，现在使用 GPL 许可。Foremost 支持恢复如下格式：avi, bmp, dll, doc, exe, gif, htm, jar, jpg, mbd, mov, mpg, pdf, png, ppt, rar, rif, sdw, sx, sxc, sxi, sxw, vis, wav, wmv, xls, zip。<br>针对 Linux 下的 ext 文件系统来说，常用的 Linux 文件删除恢复工具有 debugfs、ext3grep、extundelete 等。extundelete 是一个开源的数据恢复工具，支持 ext3、ext4 文件系统，其官方站点位于<a href="http://extundelete.sourceforce.net/，目前最新稳定版本为" target="_blank" rel="external">http://extundelete.sourceforce.net/，目前最新稳定版本为</a> 0.2.0。<br>上面介绍的两种命令行工具 foremost 和 extundelete 二者相比，foremost 支持的文件系统比较多（包括 ext2、 ext3 、vfat、NTFS、ufs、jfs 等）和 extundelete 支持的文件系统较少（ext3、ext4）文件系统。不过 foremost 只能支持恢复特定格式的文件。</p>
<h3 id="使用_foremost">使用 foremost</h3><p>首先安装软件包<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install foremost</span><br></pre></td></tr></table></figure></p>
<p>其它 Linux 发行版用户可以在 <a href="http://foremost.sourceforge.net/" target="_blank" rel="external">http://foremost.sourceforge.net/</a> 下载源代码编译安装。下面看看使用方法。</p>
<h4 id="恢复单个类型文件">恢复单个类型文件</h4><p>笔者删除一个 USB（/dev/sdba1）存储器中一个 png 文件然后使用 formost 恢复。<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm -f /dev/sdb1/photo1.png&#10;foremost -t png -i /dev/sdb1</span><br></pre></td></tr></table></figure></p>
<p>恢复完成后会在当前目录建立一个 output 目录，在 output 目录下会建立 png 子目录下会包括所有可以恢复的 png 格式的文件。<br>需要说明的是 png 子目录下会包括的 png 格式的文件名称已经改变，另外 output 目录下的 audit.txt 文件是恢复文件列表。</p>
<h4 id="恢复多个类型文件">恢复多个类型文件</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">foremost -v -T -t doc,pdf,jpg,gif -i /dev/sda6 -o /media/disk/Recover</span><br></pre></td></tr></table></figure>
<p>恢复完成后会在当前目录建立一个 output 目录，在 output 目录下会建立四个子目录（/doc,/pdf,/jpg,/gif），分别包括四种类型文件。另外 output 目录下的 audit.txt 文件是恢复文件列表。</p>
<h3 id="使用_extundelete">使用 extundelete</h3><p>首先安装软件包<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install extundelete</span><br></pre></td></tr></table></figure></p>
<p>其它 Linux 发行版用户可以在<a href="http://extundelete.sourceforce.net/下载源代码编译安装。下载安装" target="_blank" rel="external">http://extundelete.sourceforce.net/下载源代码编译安装。下载安装</a> extundelete 之前要安装两个软件包 e2fsprogs 和 e2fslibs。下面看看使用方法</p>
<h4 id="模拟数据误删除环境">模拟数据误删除环境</h4><p>这里我们使用一个分区/dev/sdd1 挂在在/backupdate 上，建立一个测试目录/delete 并建立一文件：del1.txt 。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mkdir –p /backupdate/deldate</span></span><br><span class="line"><span class="comment"># mkfs.ext4 /dev/sdd1</span></span><br><span class="line"><span class="comment"># mount /dev/sdd1 /backupdate</span></span><br><span class="line"><span class="comment">#cd /backupdate/deldate</span></span><br><span class="line"><span class="comment"># touch del1.txt</span></span><br><span class="line"><span class="comment"># echo " test 1" &gt; del1.txt</span></span><br><span class="line">获取文件校验码</span><br><span class="line"><span class="comment"># md5sum del1.txt| | |    </span></span><br><span class="line"> <span class="number">66</span>fb6627dbaa37721048e4549db3224d  del1.txt</span><br><span class="line"></span><br><span class="line">删除文件</span><br><span class="line"><span class="comment"># rm -fr /backupdate/*   </span></span><br><span class="line"></span><br><span class="line">卸载文件系统或者挂载为只读</span><br><span class="line"><span class="comment"># umount /backupdate</span></span><br><span class="line">查询恢复数据信息，注意这里的--inode <span class="number">2</span> 这里会扫描分区 ：</span><br><span class="line"><span class="comment"># extundelete /dev/sdd1 --inode 2</span></span><br><span class="line">.....</span><br><span class="line">File name| | | |        | Inode number | Deleted status</span><br><span class="line">Directory block <span class="number">8657</span>:</span><br><span class="line">.| | | | | |  <span class="number">2</span></span><br><span class="line">..| | | | | | <span class="number">2</span></span><br><span class="line">lost+found| | | | | <span class="number">11</span>|      Deleted</span><br><span class="line">del1.txt| | | | |       <span class="number">12</span>|      Deleted</span><br></pre></td></tr></table></figure></p>
<p>上面标记为 Deleted 是已经删除的文件或目录<br>开始恢复文件<br>默认恢复到当前目录下的 RECOVERED_FILES 目录中去。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># extundelete /dev/sdd1 --restore-file del1.txt</span></span><br><span class="line">如果恢复一个目录</span><br><span class="line"><span class="comment"># extundelete /dev/sdd1 --restore-directory /backupdate/deldate</span></span><br><span class="line">恢复所有文件</span><br><span class="line"><span class="comment"># extundelete /dev/sdd1 --restore-all</span></span><br><span class="line">获取恢复文件校验码，对比检测是否恢复成功</span><br><span class="line"><span class="comment"># md5sum RECOVERED_FILES/ del1.txt| | |  </span></span><br><span class="line"><span class="number">66</span>fb6627dbaa37721048e4549db3224d  RECOVERED_FILES/del1.txt</span><br></pre></td></tr></table></figure></p>
<p>查看校验码与之前的是否完全一致。<br>应用总结：笔者在现实使用过程中发现 extundelete 还是有很大的不完整性,基于整个磁盘的恢复功能较为强大,基于目录和文件的恢复还不够强大。在 Linux 下误删除了文件，当发现数据丢失以后，不要进行任何操作，保留现场。要想办法把数据丢失的文件系统经过 dd 命令或者 AIR(Automated Image Restore，<a href="http://cdnetworks-kr-2.dl.sourceforge.net/" target="_blank" rel="external">http://cdnetworks-kr-2.dl.sourceforge.net/</a> )工具到另外的存储空间上作为最原始的备份，以便数据恢复专家现场诊断恢复。<br>使用 scalpel<br>以上介绍的工具主要使用在 ext3 和 ext4 的文件系统，如果用户使用的那些没有日志机制的旧有文件系统，可以使用 scalpel 工具。scalpel 是一种快速文件恢复工具，它通过读取文件系统的数据库来恢复文件。它是独立于文件系统的。<br>用户可以在<a href="http://www.digitalforensicssolutions.com/Scalpel/" target="_blank" rel="external">http://www.digitalforensicssolutions.com/Scalpel/</a> 下载源代码编译安装。下面看看使用方法：<br>使用 scalpel 工具之前，首先要修改配置文件： /etc/scalpel/scalpel.conf。<br>例如用户要恢复所有删除 pdf 文件，那么要在/etc/scalpel/scalpel.conf 把包括 pdf 文件格式的两行之前的# 去掉。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[...]</span><br><span class="line">| pdf     y       <span class="number">5000000</span> %PDF  %EOF\x0d  REVERSE</span><br><span class="line">| pdf     y       <span class="number">5000000</span> %PDF  %EOF\x0a  REVERSE</span><br><span class="line">[...]</span><br></pre></td></tr></table></figure></p>
<p>然后保存文件。<br>下面看看使用方法<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># scalpel /dev/sdb1 -o /RECOVERY/</span></span><br></pre></td></tr></table></figure></p>
<p>其中/dev/sdb1 是目标驱动器，/RECOVERY/ 是恢复文件存储目录。目录下的 audit.txt 文件是恢复文件列表。</p>
<h2 id="使用字符终端工具_testdisk_和_phtorec">使用字符终端工具 testdisk 和 phtorec</h2><h3 id="testdisk_简介">testdisk 简介</h3><p>testdisk 是分区表恢复、raid 恢复、分区恢复的开源免费工具（testdisk 支持如下文件系统: FAT12/FAT16/FAT32/NTFS/ext2/ext3/ext4）。testdisk 支持的功能: 修复分区表, 恢复已删除分区，用 FAT32 备份表恢复启动扇区，重建 FAT12/FAT16/FAT32 启动扇区，修复 FAT 表，重建 NTFS 启动扇区，用备份表恢复 NTFS 启动扇区，用 mft 镜像表(mft mirror)修复 mft 表，查找 ext2/ext3 备份的 superblock，从 FAT,NTFS 及 ext2 文件系统恢复删除文件，从已删除的 FAT,NTFS 及 ext2/ext3 分区复制文件。</p>
<h3 id="使用方法">使用方法</h3><h4 id="首先安装">首先安装</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># scalpel /dev/sdb1 -o /RECOVERY/</span></span><br></pre></td></tr></table></figure>
<p>其它 Linux 发行版用户可以在<a href="http://www.cgsecurity.org/wiki/TestDisk_Download" target="_blank" rel="external">http://www.cgsecurity.org/wiki/TestDisk_Download</a> 下载源代码编译安装。下载安装 testdisk 之前要安装几个软件包 libjpeg8 ，libncursesw5， libuuid1， zlib1g 。下面看看使用方法</p>
<h4 id="启动_testdisk">启动 testdisk</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#testdisk</span></span><br></pre></td></tr></table></figure>
<p>testdisk 启动后的工作界面首先是选择恢复操作中的 log 文件（testdisk.log）的纪录方式见图 1。</p>
<h5 id="图_1-选择恢复操作中的_log_文件的纪录方式">图 1.选择恢复操作中的 log 文件的纪录方式</h5><p><img src="https://img.alicdn.com/imgextra/i4/1134915854/TB21c9JjXXXXXbnXpXXXXXXXXXX_!!1134915854.jpg" alt="图 1 选择恢复操作中的 log 文件的纪录方式"><br>［Create］新建<br>［Append］追加<br>［No Log］不纪录<br>选择了 log 文件的记录方式后、系统显示处于连接状态的磁盘设备见图 2。</p>
<h5 id="图_2-处于连接状态的磁盘设备">图 2.处于连接状态的磁盘设备</h5><p><img src="https://img.alicdn.com/imgextra/i1/1134915854/TB2VSe0jXXXXXctXXXXXXXXXXXX_!!1134915854.jpg" alt="图 2 处于连接状态的磁盘设备"><br>在列出的磁盘设备中，选择要恢复的分区，然后选择磁盘分区的种类。若是 ext4 文件系统的话,请选择 [None ] Non partitioned media 见图 3</p>
<h5 id="图_3-选择_[None_]_Non_partitioned_media">图 3.选择 [None ] Non partitioned media</h5><p><img src="https://img.alicdn.com/imgextra/i4/1134915854/TB2T4KLjXXXXXaLXpXXXXXXXXXX_!!1134915854.jpg" alt=""><br>说明：一般选择[Intel] Intel/PC partition（如果是 GPT 分区，请选择 EFI GPT），对于 ext4 文件系统选择 [Intel] Intel/PC partition 也能正确识别,只是分析硬盘時比较慢。<br>下面的画面中选择［Analyse］，对分区进行分析见图 4。</p>
<h5 id="图_4-对分区进行分析">图 4.对分区进行分析</h5><p><img src="https://img.alicdn.com/imgextra/i1/1134915854/TB26LSGjXXXXXb2XpXXXXXXXXXX_!!1134915854.jpg" alt="图 4 对分区进行分析"><br>下面显示了当前分区的状态。这是软件分析的当前分区表的分区结果，我们选择“Deep Search”进行一次深入检测见图 5。</p>
<h5 id="图_5-选择“Deep_Search”进行一次深入检测">图 5.选择“Deep Search”进行一次深入检测</h5><p><img src="https://img.alicdn.com/imgextra/i1/1134915854/TB2X4SNjXXXXXaAXpXXXXXXXXXX_!!1134915854.jpg" alt="图 5 选择“Deep Search”进行一次深入检测"><br>下面是检测完成界面见图 6</p>
<h5 id="图_6-检测完成界面">图 6.检测完成界面</h5><p><img src="https://img.alicdn.com/imgextra/i3/1134915854/TB29fmQjXXXXXXRXpXXXXXXXXXX_!!1134915854.jpg" alt="图 6 检测完成界面"><br>在这个画面时,按 P 键就可以列出硬盘上的文件见图 7</p>
<h5 id="图_7-红色的文件名称就是已经被删除的文件">图 7.红色的文件名称就是已经被删除的文件</h5><p><img src="https://img.alicdn.com/imgextra/i4/1134915854/TB2XWLXjXXXXXavXXXXXXXXXXXX_!!1134915854.jpg" alt="图 7 红色的文件名称就是已经被删除的文件"><br>红色的文件名称就是已经被删除的文件,选择好你要恢复的文件后,按 c 键之后,它就会问你要复制到哪个目录,这时请选择你要 复制的目地地(destination)即可。</p>
<h3 id="photorec_简介">photorec 简介</h3><p>photorec 是一款用于恢复硬盘、光盘中丢失的视频、文档、压缩包等文件，或从数码相机存储卡中恢复丢失图片的数据恢复软件（因此，该软件命名为 photo recovery 这个名字)。 photorec 忽略文件系统，能直接从介质底层恢复数据，因此，在介质的文件系统严重破坏或被重新格式化后，它也能进行数据恢复。出于安全考虑, photorec 以只读方式来访问您要恢复数据所在的磁盘或存储卡介质。提示: 一旦发现丢失或意外删除了某个图片、文件， 请不要继续往该存储设备或磁盘保存新文件；否则您可能会覆盖原来的数据。 这意味着您在使用 photorec 时，您千万不要将恢复的文件写入到原数据所存储的同一分区。</p>
<h3 id="使用_photorec_恢复文件">使用 photorec 恢复文件</h3><p>photorec 是 testdisk 的伴侣程序，安装 testdisk 后 photorec 就可以使用了。</p>
<h4 id="启动_photorec">启动 photorec</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># photorec</span></span><br></pre></td></tr></table></figure>
<p>图 8 中显示了已连接磁盘设备，准备恢复的文件在那个设备上就选择它，然后在选择 Proceed 按钮继续下一步。</p>
<h5 id="图_8-已连接磁盘设备">图 8.已连接磁盘设备</h5><p><img src="https://img.alicdn.com/imgextra/i2/1134915854/TB27kaQjXXXXXabXpXXXXXXXXXX_!!1134915854.jpg" alt="图 8 已连接磁盘设备"><br>接下来，选择恢复的磁盘分区格式。这里选择 ext4 见图 9。</p>
<h5 id="图_9-选择恢复的磁盘分区格式">图 9.选择恢复的磁盘分区格式</h5><p><img src="https://img.alicdn.com/imgextra/i4/1134915854/TB2vva.jXXXXXaSXXXXXXXXXXXX_!!1134915854.jpg" alt="图 9 选择恢复的磁盘分区格式"><br>画面下方［File Opt］中有可供恢复的文件种类提供被选择见图 10。</p>
<h5 id="图_10-可供恢复的文件种类">图 10.可供恢复的文件种类</h5><p><img src="https://img.alicdn.com/imgextra/i1/1134915854/TB2wUiIjXXXXXbrXpXXXXXXXXXX_!!1134915854.jpg" alt="图 10 可供恢复的文件种类"><br>说明：如果只是 root 据某些文件签名要恢复部分文件类型，那么可以按 s 取消全部勾选，然后移动光标到要恢复的文件类型，可按空格来选择高亮选中的类型。<br>下面设定要分析的磁盘空间区域，可整个分区搜索，也可只搜索自由空间（相当于未分配簇）见图 11 。</p>
<h5 id="图_11-设定要分析的磁盘空间区域">图 11.设定要分析的磁盘空间区域</h5><p><img src="https://img.alicdn.com/imgextra/i1/1134915854/TB20R2cjXXXXXXBXXXXXXXXXXXX_!!1134915854.jpg" alt="图 11 设定要分析的磁盘空间区域"><br>下面选择分区所使用的文件系统类型，然后设定导出的文件目录，一般输入 Y 并回车即可。图 12 是恢复完成界面。</p>
<h5 id="图_12-恢复完成">图 12.恢复完成</h5><p><img src="https://img.alicdn.com/imgextra/i2/1134915854/TB2bb18jXXXXXbiXXXXXXXXXXXX_!!1134915854.jpg" alt="图 12 恢复完成"><br>恢复完了选择 Quit 退出 PhtoRec。被恢复的文件是 recup_dir.x 的若干数字子组合为文件名被保存在当前目录的/recup_dir 子目录下的。</p>
<h3 id="功能对比">功能对比</h3><h4 id="表_1-Linux_删除文件恢复工具">表 1.Linux 删除文件恢复工具</h4><table>
<thead>
<tr>
<th>工具名称/功能对比</th>
<th>工作界面</th>
<th>功能简介</th>
</tr>
</thead>
<tbody>
<tr>
<td>foremost</td>
<td>命令行</td>
<td>formost 是一个基于文件头和尾部信息以及文件的内建数据结构恢复文件的命令行工具</td>
</tr>
<tr>
<td>extundelete</td>
<td>命令行</td>
<td>Extundelete 是 ext3、ext4 文件系统的恢复工具</td>
</tr>
<tr>
<td>scalpel</td>
<td>命令行</td>
<td>scalpel 是一种快速文件恢复工具，它通过读取文件系统的数据库来恢复文件。它是独立于文件系统的</td>
</tr>
<tr>
<td>testdisk</td>
<td>字符终端</td>
<td>Testdisk 支持分区表恢复、raid 恢复、分区恢复</td>
</tr>
<tr>
<td>phtorec</td>
<td>字符终端</td>
<td>photorec 用来恢复硬盘、光盘中丢失的视频、文档、压缩包等文件，或从数码相机存储卡中恢复丢失的图片</td>
</tr>
</tbody>
</table>
<h2 id="总结">总结</h2><p>可以使用 testdisk 进行文件恢复的场合，也就是硬盘上的分区（该分区有原有数据纪录）已经损坏的情形。但是如果损坏之后，重新再次做成了新分区的话，文件恢复的可能性比较小，很困难。photorec 不仅针对 硬盘、USB 设备、CD-ROM、SD 卡，而且还可以对其它存储设备进行应用。因此大多数常用的文件如果被误操作的话，均可利用其来进行恢复，只不过它的初衷是针对照片而制作的。</p>
<h1 id="参考资料">参考资料</h1><p><a href="http://www.ibm.com/developerworks/cn/linux/1312_caoyq_linuxrestore/" target="_blank" rel="external">http://www.ibm.com/developerworks/cn/linux/1312_caoyq_linuxrestore/</a></p>

  </div>
  <footer class="article-footer">
    
  <div class="cc">
    <a href="http://creativecommons.org/licenses/by-sa/4.0/deed.e" target="_blank" title="Attribution-ShareAlike">
      <img src="/images/cc/cc.png">
      
          <img src="/images/cc/by.png">
        
          <img src="/images/cc/sa.png">
      
      <span>
        This work is licensed under a Creative Commons Attribution-ShareAlike 4.0 International License.
      </span>
    </a>
  </div>


    

  </footer>
</article>


  <link rel="stylesheet" href="http://static.duoshuo.com/styles/embed.default.css?349d9313.css" type="text/css">
  <!-- 多说评论框 start -->
  <div class="ds-thread" data-thread-key="使用-Linux-文件恢复工具" data-title="使用 Linux 文件恢复工具" data-url="http://huyaohui.com/2016/01/03/使用-Linux-文件恢复工具/"></div>
  <!-- 多说评论框 end -->
  <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
  <script type="text/javascript">
    var duoshuoQuery = {
      short_name: "makehui"
    };
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';
      ds.async = true;
      ds.src = (document.location.protocol == 'https:'
        ? 'https:'
        : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>
  <!-- 多说公共JS代码 end -->






          <div class="main-footer">
  
    © 2017 MakeHui&#39;s 超平和バスターズはずっとなかよし - Powered by <a href="http://hexo.io" target="_blank">Hexo</a> - Theme <a href="https://github.com/denjones/hexo-theme-chan" target="_blank">Chan</a>
  
</div>

      
        </div>
      
    </div>
  </div>
  <script src="//apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js" type="text/javascript"></script>

  <link rel="stylesheet" href="/PhotoSwipe/photoswipe.css" type="text/css">
  <link rel="stylesheet" href="/PhotoSwipe/default-skin/default-skin.css" type="text/css">

  <!-- Root element of PhotoSwipe. Must have class pswp. -->
  <div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe.
             It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

      <!-- Container that holds slides.
                PhotoSwipe keeps only 3 of them in the DOM to save memory.
                Don't modify these 3 pswp__item elements, data is added later on. -->
      <div class="pswp__container">
        <div class="pswp__item"></div>
        <div class="pswp__item"></div>
        <div class="pswp__item"></div>
      </div>

      <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
      <div class="pswp__ui pswp__ui--hidden">

        <div class="pswp__top-bar">

          <!--  Controls are self-explanatory. Order can be changed. -->

          <div class="pswp__counter"></div>

          <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

          <button class="pswp__button pswp__button--share" title="Share"></button>

          <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

          <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

          <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
          <!-- element will get class pswp__preloader--active when preloader is running -->
          <div class="pswp__preloader">
            <div class="pswp__preloader__icn">
              <div class="pswp__preloader__cut">
                <div class="pswp__preloader__donut"></div>
              </div>
            </div>
          </div>
        </div>

        <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
          <div class="pswp__share-tooltip"></div>
        </div>

        <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>

        <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button>

        <div class="pswp__caption">
          <div class="pswp__caption__center"></div>
        </div>
      </div>
    </div>
  </div>

  <script src="/PhotoSwipe/photoswipe.js" type="text/javascript"></script>
  <script src="/PhotoSwipe/photoswipe-ui-default.js" type="text/javascript"></script>


<script src="/perfect-scrollbar/js/min/perfect-scrollbar.min.js" type="text/javascript"></script>
<script src="/scripts/main.js" type="text/javascript"></script>

</body>
</html>
